#!/usr/bin/env sh
. "$(dirname "$0")/_/husky.sh"

echo "Running lint-staged on staged files..."
npx lint-staged --quiet || exit 1

# Fast feedback: run related tests for just the staged files (if any)
TEST_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E "\.(ts|tsx|js|jsx)$" | grep -v "node_modules" | grep -v "\.d\.ts$" || true)
if [ -n "$TEST_FILES" ]; then
  echo "Running related tests (fast)..."
  npx jest --findRelatedTests --passWithNoTests --bail $TEST_FILES || exit 1
fi

echo "Pre-commit checks completed."
