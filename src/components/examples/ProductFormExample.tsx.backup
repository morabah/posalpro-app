'use client';

import { Card } from '@/components/ui/Card';
import { FormActions, FormErrorSummary, FormField } from '@/components/ui/FormField';
import { Button } from '@/components/ui/forms/Button';
import { ProductCreateSchema } from '@/features/products/schemas';
import {
  CubeIcon,
  CurrencyDollarIcon,
  DocumentTextIcon,
  ScaleIcon,
  TagIcon,
} from '@heroicons/react/24/outline';
import { zodResolver } from '@hookform/resolvers/zod';
import { useForm } from 'react-hook-form';

// ✅ Example Product Form using React Hook Form + Zod validation
export function ProductFormExample() {
  // ✅ REACT HOOK FORM SETUP
  const {
    register,
    control,
    handleSubmit,
    formState: { errors, isValid },
    watch,
    setValue,
  } = useForm({
    resolver: zodResolver(ProductCreateSchema),
    mode: 'onChange',
    defaultValues: {
      name: '',
      description: '',
      sku: '',
      price: undefined,
      cost: undefined,
      category: '',
      tags: [],
      status: 'draft',
      weight: undefined,
    },
  });

  // ✅ FORM SUBMISSION HANDLER
  const onSubmit = async (data: any) => {
    console.log('Form data:', data);
    // Here you would typically call your API
  };

  return (
    <Card>
      <div className="p-6">
        <h2 className="text-xl font-semibold text-gray-900 mb-6">Product Form Example</h2>

        <form onSubmit={handleSubmit(onSubmit)} className="space-y-6">
          {/* Error Summary */}
          <FormErrorSummary
            errors={Object.entries(errors).reduce(
              (acc, [key, error]) => {
                if (error?.message && typeof error.message === 'string') {
                  acc[key] = error.message;
                }
                return acc;
              },
              {} as Record<string, string>
            )}
          />

          {/* Basic Information */}
          <div className="space-y-4">
            <h3 className="text-lg font-medium text-gray-900">Basic Information</h3>

            {/* Product Name */}
            <FormField
              {...register('name')}
              name="name"
              label="Product Name"
              placeholder="Enter product name"
              value={watch('name') || ''}
              onBlur={() => register('name').onBlur}
              error={errors.name?.message}
              touched={!!errors.name}
              required
              icon={<CubeIcon className="w-5 h-5" />}
            />

            {/* SKU */}
            <FormField
              name="sku"
              label="SKU"
              placeholder="ABC123456"
              {...register('sku')}
              error={errors.sku?.message}
              touched={!!errors.sku}
              required
              icon={<TagIcon className="w-5 h-5" />}
            />

            {/* Description */}
            <FormField
              name="description"
              label="Description"
              type="textarea"
              placeholder="Enter product description"
              {...register('description')}
              error={errors.description?.message}
              touched={!!errors.description}
              icon={<DocumentTextIcon className="w-5 h-5" />}
            />
          </div>

          {/* Pricing Information */}
          <div className="space-y-4">
            <h3 className="text-lg font-medium text-gray-900">Pricing Information</h3>

            {/* Price */}
            <FormField
              name="price"
              label="Price"
              type="number"
              placeholder="0.00"
              {...register('price', { valueAsNumber: true })}
              error={errors.price?.message}
              touched={!!errors.price}
              required
              icon={<CurrencyDollarIcon className="w-5 h-5" />}
            />

            {/* Cost */}
            <FormField
              name="cost"
              label="Cost"
              type="number"
              placeholder="0.00"
              {...register('cost', { valueAsNumber: true })}
              error={errors.cost?.message}
              touched={!!errors.cost}
              icon={<CurrencyDollarIcon className="w-5 h-5" />}
            />
          </div>

          {/* Product Details */}
          <div className="space-y-4">
            <h3 className="text-lg font-medium text-gray-900">Product Details</h3>

            {/* Category */}
            <FormField
              name="category"
              label="Category"
              placeholder="e.g., Electronics, Clothing"
              {...register('category')}
              error={errors.category?.message}
              touched={!!errors.category}
            />

            {/* Weight */}
            <FormField
              name="weight"
              label="Weight (kg)"
              type="number"
              placeholder="0.0"
              {...register('weight', { valueAsNumber: true })}
              error={errors.weight?.message}
              touched={!!errors.weight}
              icon={<ScaleIcon className="w-5 h-5" />}
            />

            {/* Status */}
            <div className="space-y-2">
              <label className="block text-sm font-medium text-gray-700">
                Status <span className="text-red-500">*</span>
              </label>
              <select
                {...register('status')}
                className={`w-full border-b bg-transparent focus:outline-none ${
                  errors.status
                    ? 'border-red-500 focus:border-red-500'
                    : 'border-gray-300 focus:border-blue-500'
                }`}
              >
                <option value="draft">Draft</option>
                <option value="active">Active</option>
                <option value="inactive">Inactive</option>
              </select>
              {errors.status && (
                <p className="text-sm text-red-600">{errors.status.message}</p>
              )}
            </div>
          </div>

          {/* Form Actions */}
          <FormActions>
            <Button
              type="button"
              variant="secondary"
              onClick={() => {
                setValue('name', '');
                setValue('description', '');
                setValue('sku', '');
                setValue('price', undefined);
                setValue('cost', undefined);
                setValue('category', '');
                setValue('status', 'draft');
                setValue('weight', undefined);
              }}
              disabled={!Object.keys(errors).length}
            >
              Reset
            </Button>
            <Button
              type="submit"
              variant="primary"
              disabled={!isValid}
            >
              Save Product
            </Button>
          </FormActions>
        </form>

        {/* Debug Information */}
        <div className="mt-6 p-4 bg-gray-50 rounded-md">
          <h4 className="text-sm font-medium text-gray-700 mb-2">Debug Info:</h4>
          <div className="text-xs text-gray-600 space-y-1">
            <div>Form Valid: {isValid ? 'Yes' : 'No'}</div>
            <div>Has Errors: {Object.keys(errors).length > 0 ? 'Yes' : 'No'}</div>
            <div>Error Count: {Object.keys(errors).length}</div>
            <div>Touched Fields: {Object.keys(errors).join(', ')}</div>
            <div>Status: {watch('status')}</div>
          </div>
        </div>
      </div>
    </Card>
  );
}
